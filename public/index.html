<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Good Deeds</title>
    <!-- Stylesheets -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
    <!--Favicon-->
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
    <!-- Responsive -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link href="css/responsive.css" rel="stylesheet">
</head>


<body>
    <div class="page-wrapper">

        <!-- Main Header-->
        <header class="main-header">
            <div class="header-top">
                <div class="container">
                    <div class="col-md-12 text-center">
                        <div class="main-logo">
                            <figure>
                                <a href="home.html"><img src="images/gooddeedslogo.svg" alt=""></a>
                            </figure>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header-lower">
                <div class="container">
                    <div class="header-area">
                        <nav class="main-menu">
                            <div class="navbar-header clearfix">
                                <!-- Toggle Button -->
                                <button type="button" class="navbar-toggle" data-toggle="collapse"
                                    data-target=".navbar-collapse">
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                            </div>

                            <div class="navbar-collapse collapse clearfix">
                                <ul class="navigation clearfix">
                                    <li class="current"><a href="index.html">Home</a></li>
                                    <li><a href="about.html">About</a></li>
                                    <li><a href="contact.html">Contact</a></li>
                                </ul>
                            </div>
                        </nav>
                        <div class="link-btn">
                            <a href="search.html" class="theme-btn btn-style-one">Search</a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sticky-header">
                <div class="container clearfix">
                    <!--Logo-->
                    <div class="logo">
                        <a href="index.html"><img src="images/gooddeedslogo_blk.svg" alt=""></a>
                    </div>

                    <!--Right Col-->
                    <div class="right-col">
                        <!-- Main Menu -->
                        <nav class="main-menu">
                            <div class="navbar-header clearfix">
                                <!-- Toggle Button -->
                                <button type="button" class="navbar-toggle" data-toggle="collapse"
                                    data-target=".navbar-collapse">
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                            </div>

                            <div class="navbar-collapse collapse clearfix">
                                <ul class="navigation clearfix">
                                    <li class="current"><a href="index.html">Home</a></li>
                                    <li><a href="about.html">About</a></li>
                                    <li><a href="contact-us.html">Contact</a></li>
                                </ul>
                            </div>
                        </nav><!-- Main Menu End-->
                    </div>
                </div>
            </div>
        </header>
        <!--End Main Header -->

        <!--Charities-Random-section *** THIS SECTION IS NOT MVP AND FURTHER REVIEW IS NEEDED *** -->
        <section class="couses-section">
            <div class="container">
                <div class="sec-title text-center">
                    <h3>local <span>charities</span></h3>
                    <p>Based on your location we suggest the following charities around you</p>
                </div>
                <!--Start Google map area-->
                <div id="contact-google-map"></div>
                <br>
                <div class="row" id="charity">
                </div>
            </div>
        </section>
        <!--End couses-section-->


        <!--welcome-section *** MVP *** -->
        <section class="welcome-section">
            <div class="container-fullwidth">
                <div class="row">
                    <div class="image-column col-lg-12 col-md-12 col-sm-12 col-xs-12">
                        <div class="image-content">
                            <div class="sec-title">
                                <h3>How you can <span>Help </span></h3>
                                <p>This is how you can help your local community</p>
                            </div>
                            <div class="item-list">
                                <div class="row">
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <div class="item text-center">
                                            <div class="icon-box">
                                                <span class="flaticon-charity-donation"></span>
                                            </div>
                                            <h6>Become Donor</h6>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <div class="item text-center">
                                            <div class="icon-box">
                                                <span class="flaticon-saving-pig"></span>
                                            </div>
                                            <h6>Fundraising</h6>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <div class="item text-center">
                                            <div class="icon-box">
                                                <span class="flaticon-users-group"></span>
                                            </div>
                                            <h6>Become Volunteer</h6>
                                        </div>
                                    </div>
                                    <div class="col-md-3 col-sm-6 col-xs-12">
                                        <div class="item text-center">
                                            <div class="icon-box">
                                                <span class="flaticon-people"></span>
                                            </div>
                                            <h6>Help a Child</h6>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!--End welcome-section-->

        <!--subscribe section-->
        <section class="gellary-subscribe">
            <div class="container">
                <div class="content-text clearfix">
                    <h3>Lets make the <br><span>world better</span> together</h3>
                    <div class="link-btn">
                        <a href="#">Subscribe</a>
                    </div>
                </div>
            </div>
        </section>
        <!--subscribe section-->

        <!--events-section *** THIS IS NOT MVP *** -->
        <section class="events-section">
            <div class="container">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="sec-title">
                            <h3>Upcoming <span>Events</span></h3>
                        </div>

                        <div id="contact-google-map-event"></div>
                        <br>
                        <br>

                        <div id="events-slide" class="events-slide">
                        </div>
                        <div class="slider-pager">
                            <ul class="nav-link list-inline">
                                <li id="slider-prev"></li>
                                <li id="slider-next"></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!--End events-section-->

        <!--Main Footer-->
        <footer class="main-footer">
            <div class="container">
                <!--Widgets Section-->
                <div class="widgets-section">
                    <div class="footer-column text-center">
                        <div class="footer-logo">
                            <a href="index.html"><img src="images/logo-2.png" alt=""></a>
                        </div>
                    </div>
                </div>
            </div>
            <!--Footer Bottom-->
            <div class="footer-bottom">
                <div class="container">
                    <div class="copyright-text text-center">Copyright &copy; Charity APP 2019. All
                        Rights Reserved</div>
                </div>
            </div>
        </footer>
        <!--Main Footer-->
    </div>
    <!--End pagewrapper-->

    <!--Scroll to top-->
    <div class="scroll-to-top scroll-to-target" data-target=".main-header"><span
            class="icon fa fa-long-arrow-up"></span></div>


    <script src="js/jquery.js"></script>
    <script src="js/jquery.bxslider.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mixitup/3.3.1/mixitup.min.js"></script>
    
    <!-- gmap helper -->
    <script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAHzPSV2jshbjI8fqnC_C4L08ffnj5EN3A"></script>
    <!--gmap script-->
    <script src="js/gmaps.js"></script>
    <script>
        var API_KEY= "AIzaSyAHzPSV2jshbjI8fqnC_C4L08ffnj5EN3A";
        var API_KEY_PRO = "AIzaSyCDd9mg5blcxDthtRIGYiPaZCfCRgObEmI";
        var map;
        var map_event;
        var latme;
        var lngme;
        var listRandom = [];
        var dataCharity = function () {
            this.charityName = null;
            this.charityNextLine = null;
            this.charityAbout = null;
            this.charityUrl = null;
            this.address = null;
        };
        $(document).ready(function() {
           
            
            GMaps.geolocate({
            success: function(position) {
               latme = position.coords.latitude;
               lngme = position.coords.longitude;
               map = new GMaps({
                    div: '#contact-google-map',
                    zoom: 11,
                    lat: 39.910095,
                    lng: -76.814430
                    //lat: latme,
                    //lng: lngme
               });
               map_event = new GMaps({
                    div: '#contact-google-map-event',
                    zoom: 11,
                    lat: 39.910095,
                    lng: -76.814430
                    //lat: latme,
                    //lng: lngme
               });
               printMap(latme,lngme);
               printEvent(latme,lngme);
            },
                error: function(error) {
                alert('Geolocation failed: '+error.message);
            },
                not_supported: function() {
            },
                always: function() {
                    //alert("Done!");
                }
            });
                      
            $("#contact-google-map").css("height", "400px");
            $("#contact-google-map-event").css("height", "400px");
            
        });

        function arrayRemove(arr, value) {
            return arr.filter(function(ele){
                return ele != value;
            });
        }

        function printMap(latme,lngme){
            var queryURL = 'https://maps.googleapis.com/maps/api/geocode/json?latlng='+latme+','+lngme+'&key='+API_KEY;
            $.ajax({
                url: queryURL,
                method: 'GET'
            }).then(function (response) {
                const id = 'aa69566f';
                //var zip  = response.results[0].address_components[6].short_name;
                var zip = '17408';
                const key = '6e6269f3d39bb81c4b37878dfaaef2f6';
                queryURL ='https://api.data.charitynavigator.org/v2/Organizations?app_id=' +id +'&app_key=' + key +'&pageSize=15&zip=' +zip;
                $.ajax({
                    url: queryURL,
                    method: 'GET'
                }).then(function (response) {
                    for (let i = 0; i < response.length; i++) {       
                        let charityName = response[i].charityName
                        let charityCity = response[i].mailingAddress.city
                        let charityAddress = response[i].mailingAddress.streetAddress1
                        let charityUrl = response[i].charityNavigatorURL
                        let charityFocus = response[i].irsClassification.nteeType
                        let charityNextLine = response[i].irsClassification.classification
                        let charityAbout = response[i].irsClassification.affiliation
                        let zip = response[i].mailingAddress.postalCode.split("-");
                        let address = charityAddress+", "+zip[0]+", "+charityCity;

                        var datacharity = new dataCharity();
                        datacharity.charityName = charityName;
                        datacharity.charityNextLine = charityNextLine;
                        datacharity.charityAbout = charityAbout;
                        datacharity.charityUrl = charityUrl;
                        datacharity.address = address;
                        listRandom.push(datacharity);
                    }
                    
                    
                    if(listRandom.length>3){                   
                        for(let i = 0; i < 3; i++){
                            var randomItem = listRandom[Math.floor(Math.random()*listRandom.length)];
                            listRandom = arrayRemove(listRandom, randomItem);
                            var text = '<div class="image-column col-md-4 col-sm-6 col-xs-12"><div class="image-holder"><div class="image-content"><h5>'+randomItem.charityName+'<br>'+randomItem.charityNextLine+'</h5><p>'+randomItem.charityAbout+'</p><div class="link-btn"><a href="'+randomItem.charityUrl+'" target="_blank" class="btn-style-three">More Info</a></div></div></div></div>';
                            $("#charity").append(text);
                            getCoordinates(randomItem.charityName,randomItem.address,randomItem.charityUrl);
                        }
                    }else{
                        for(let i = 0; i < listRandom.length; i++){
                            var text = '<div class="image-column col-md-4 col-sm-6 col-xs-12"><div class="image-holder"><div class="image-content"><h5>'+listRandom[i].charityName+'<br>'+listRandom[i].charityNextLine+'</h5><p>'+listRandom[i].charityAbout+'</p><div class="link-btn"><a href="'+listRandom[i].charityUrl+'" target="_blank" class="btn-style-three">More Info</a></div></div></div></div>';
                            $("#charity").append(text); 
                            getCoordinates(listRandom[i].charityName,listRandom[i].address,listRandom[i].charityUrl);
                        }
                    }
                })

            });

        }

        function getCoordinates(charityName,address,url){
            let queryURL ='https://maps.googleapis.com/maps/api/geocode/json?address=' +address +'&key='+API_KEY;
            $.ajax({
                url: queryURL,
                method: 'GET'
            }).then(function (response) {
                var latitude = response.results[0].geometry.location.lat;
                var longitude = response.results[0].geometry.location.lng;
                map.addMarker({
                    lat: latitude,
                    lng: longitude,
                    title: charityName,
                    click: function(e) {
                        window.open(url,'_blank');
                    }
                });
            })
        }

        function printEvent(latme,lngme){
            var latme = 39.910095;
            var lngme = -76.814430; 
            const token = 'LTV5SOWTS6QBZF72VGDA';
            let queryURL = 'https://www.eventbriteapi.com/v3/events/search/?location.longitude='+lngme +'&location.latitude=' +latme +'&expand=venue&token=' +token;
            $.ajax({
                url: queryURL,
                method: 'GET'
            }).then(function (response) {
                let results = response.events;
                //console.log("resultado "+results);
                for (var i = 0; i < results.length; i++) {
                let name = results[i].name.text
                let description = results[i].description.text
                let url = results[i].url
                let date = new Date(results[i].start.local);
                let location = results[i].venue.address.localized_address_display +" - "+results[i].venue.address.country;
                let latitude = results[i].venue.address.latitude;
                let longitude = results[i].venue.address.longitude;
                map_event.addMarker({
                    lat: latitude,
                    lng: longitude,
                    title: name,
                    click: function(e) {
                        window.open(url,'_blank');
                    }
                });
                var todayDate = date.toISOString().slice(0,10);
                var time = date.toTimeString().split(' ')[0];
                var text = '<div class="slide-item"><div class="left-side"><div class="image-box"><figure><a href="" ><img src="images/asfalt-light.png" alt=""></a></figure></div><h5>'+todayDate+'</h5></div><div class="right-side comment"><a href='+url+' target="_blank"><h4>'+name+'</h4></a><ul><li><i class="fa fa-clock-o" aria-hidden="true"></i>'+time+'</li><li><i class="fa fa-map-marker" aria-hidden="true"></i>'+location+'</li></ul><p>'+description+'</p></div></div>';
                $("#events-slide").append(text);

                }
                if($('.events-slide').length){
                    var slider = $('.events-slide').bxSlider({
                        auto:true,
                        mode:'vertical',
                        nextText: '<i class="fa fa-angle-right"></i>',
                        prevText: '<i class="fa fa-angle-left"></i>',
                        maxSlides: 3,
                        minSlides: 3,
                        moveSlides: 1,
                        pause: 5000,
                        speed: 700,
                        pagerCustom: '.events-section .slider-pager .thumb-box'
                    });
                    $('#slider-next').click(function(){
                        slider.goToNextSlide();
                        return false;
                    });
                    $('#slider-prev').click(function(){
                        slider.goToPrevSlide();
                        return false;
                    });
	            }  
            })

        }


        
    </script>
    <script src="js/script.js"></script>
    <script src="js/map-helper.js"></script>
    <script src="js/googlemaps.js"></script>
</body>

</html>